## 卡牌模块

1. 初始化牌组 `InitializePlayerDeck`：当玩家进入游戏时

    * 创建新的 `PlayerCardState`
    * 从数据库获取所有基础牌（8张）和功能牌（4张）
    * 添加到牌库并更新计数
    * 随机打乱牌库
    * 初始化空的手牌和弃牌堆

2. 抽牌机制

    * 初始抽牌 `DrawInitialCards`
        * 调用 `DrawCards` 抽取初始手牌：基础牌2张,功能牌1张
    * 抽牌过程 `DrawCards`
        * 获取当前玩家状态
        * 检查手牌上限限制
        * 打乱牌库
        * 按类型抽取指定数量的牌
        * 更新玩家手牌、牌库及相关计数

3. 出牌系统 `PlayCard`：当玩家打出一张牌时

    * 验证该牌是否在手牌中
    * 检查出牌规则：每回合只能出一张基础牌
    * 从手牌移除该牌
    * 更新手牌计数
    * 将该牌加入弃牌堆
    * 如果是基础牌，标记本回合已出过基础牌

4. 回合结束 `EndTurn`：当玩家结束回合时

    * 使用事务确保状态一致性
    * 重置基础牌出牌标记 `BasicCardPlayed = false`
    * 计算需要补充的牌数：
        * 基础牌补至3张
        * 功能牌补至当前阶段上限（3-7张）
    * 调用 `DrawCards` 补充手牌

5. 状态查询 `GetCardState`：提供玩家当前游戏状态信息

    * 获取玩家和对手的状态
    * 返回详细信息：
        * 自己的手牌详细信息
        * 自己的牌库数量
        * 自己的弃牌堆数量
        * 对手的手牌数量
        * 对手的牌库数量
        * 对手的弃牌堆数量

* 特殊规则处理
    * 手牌上限:
        * 基础牌固定为 3 张
        * 功能牌根据游戏阶段变化（3-7张）
    * 出牌限制:
        * 每回合只能出一张基础牌
        * 功能牌没有数量限制
    * 游戏阶段:
        * 影响功能牌手牌上限
        * 随游戏进程递增（Stage1-Stage6）

* 数据一致性保证
    * 使用事务处理关键操作
    * 统一的计数更新机制
    * `JSON` 格式存储卡牌列表
    * 实时手牌数量验证