## 月华游戏后端服务器详细需求文档

目前的想法是用虚幻五来先开发单机然后上架 steam，包括基本的玩法和剧情等，然后后端服务器这边同步开发，后续考虑为单机接入联机功能，或额外发布一个联机版，或先在网页版上线

用了~~删除线~~的表示已经实现了的功能

* 基础服务模块
    * 用户系统
        * ~~用户注册、登录、认证~~
        * ~~JWT token生成和验证~~
        * ~~中间件保护需要认证的路由~~
        * 玩家进度存储与读取
        * 用户数据安全保护
        * 权限管理
    * 游戏房间管理
        * PVP对战房间创建与匹配
        * 游戏状态同步
        * 断线重连机制
        * 异常处理机制
* 核心游戏逻辑
    * 卡牌系统
        * 牌库管理
        * 基础月相牌（8种）管理
        * 功能牌管理（分章节解锁）
        * 牌组构建验证
        * 抽牌机制
            * 首回合：基础牌2张，功能牌1张
            * 补牌至上限：基础牌3张，功能牌3-7张
        * 出牌规则校验
            * 每回合限制：基础牌1张，功能牌无限制
        * 牌的归属权追踪
* 计分与触发系统
    * 月光值计算
        * 同相触发（+1）
        * 反相触发（+2）
        * 月相周期（+3-8）
    * 多路径并行计算
    * 归属权变更计算
    * 星辉灌注效果追踪
* 地图系统
    * 对战地图管理
        * PVE：9-16格不等
        * PVP：竞速地图
    * 格子状态管理
    * 归属权冲突处理
* PVE模式（可以将单机的数据导到这里面，还可以选择想要重玩哪个存档）
    * 章节管理
        * 6个章节进度追踪
        * 每章解锁条件验证
        * 剧情内容管理
        * 通关奖励发放
    * AI系统
        * AI决策逻辑
        * 基础AI行为
        * 第六章镜像AI
        * AI难度动态调整
        * AI策略模式切换
    * 肉鸽元素
        * 随机事件系统
        * 多线叙事管理
        * 轮回机制实现
* PVP模式
    * 竞速系统
        * 前进资格验证
        * 月光消耗计算
        * 玩家进度追踪
    * 全局事件
        * 月光风暴触发
        * 干扰区效果
        * 事件计时器
    * 对抗机制
        * 归属权争夺
        * 玩家互动效果
        * 实时同步处理
* 技术要求
    * 性能指标
        * 响应时间：<100ms
        * 并发处理：支持同时1000人在线
        * 数据一致性保证
        * 状态同步延迟<50ms
    * 扩展性要求
        * 支持新章节添加
        * 支持新卡牌类型
        * 支持新游戏模式
        * 支持规则动态调整
    * 安全要求
        * 防作弊系统
        * 数据加密传输
        * 敏感信息保护
        * 操作验证机制
* 数据持久化
    * 存储内容
        * 用户信息
        * 游戏进度
        * 卡牌收集
        * 对战记录
        * 成就系统
    * 备份恢复
        * 定时备份机制
        * 数据恢复方案
        * 版本管理
        * 数据迁移支持
* 监控和运维
    * 系统监控
        * 性能监控
        * 错误日志
        * 用户行为分析
        * 资源使用监控
    * 运维支持
        * 热更新机制
        * 版本回滚
        * 问题诊断工具
        * 运营数据统计