# 月华
《月华》是一款以**月相变化**为核心机制，结合了牌组构建、竞速、跑分、肉鸽（Rogue-like）等多种机制以及**中国传统元素**的单机游戏，[详情]()（网站建设中）

目前《月华》处于早期开发和概念阶段，预计在3月初会发布第一版初始demo

本仓库是《月华》的后端开发仓库，旨在记录我的独立开发过程

## 服务器架构

本项目使用微服务架构，结合GO语言与C++，在Ubuntu环境下实现高并发支持和状态实时更新

* **Go 服务**：主服务器，用于处理用户请求和管理业务逻辑
    * 主程序：负责启动服务和初始化
        * 使用Go的标准库来搭建Web服务（net/http，gin，echo等框架可以选择）
        * 提供RESTful API来与前端和C++服务交互
        * 使用goroutine和channel来处理并发任务
    * 数据库管理：使用gorm库来与MySQL进行交互
    * 缓存管理：使用go-redis库来实现与Redis的连接
    * 高性能服务：如果需要计算密集型任务，Go通过调用C++的接口来将计算任务交给C++模块处理
    * API网关：负责对外暴露接口，并与后端各个服务进行路由转发
* **C++服务**：计算密集型的服务，通过gRPC或HTTP与Go服务通信
    * 用C++编写一些计算密集型的任务（如数据处理、图像处理等）
    * C++与Go通过gRPC进行通信：
        * 定义Protobuf接口，Go与C++服务分别实现该接口
        * 通过gRPC请求来进行跨语言的数据传递和函数调用
* API网关：负责前后端之间的请求路由，可以使用Nginx或者使用Go自定义开发
    * 通过RESTful API（或者gRPC）来设计后端的各个接口。
    * 例如：
        * 用户登录（POST /login）
        * 获取商品信息（GET /products）
        * 创建订单（POST /orders）
        * 获取用户订单（GET /orders/{userId}）
* 数据库：
    * MySQL：关系型数据存储
        * 设计数据表来存储用户信息、商品信息、订单信息等。
        * 需要用到gorm（Go的ORM框架）来简化数据库操作。
    * Redis：缓存
        * 用作缓存，提升数据访问的效率。例如可以缓存热门商品、用户信息等。
    * ElasticSearch：日志和数据索引检索
        * 用于商品的全文搜索以及日志的存储和查询。
* 容器化：Docker + Kubernetes（用于扩展和容器化部署）
    * Docker化：
        * 为每个服务（Go服务、C++服务、MySQL、Redis等）创建一个Docker镜像。
        * 使用docker-compose来管理多个容器的运行。
    * Kubernetes：
        * 部署在Kubernetes上，确保服务的高可用和可伸缩性。
        * 使用Kubernetes的Deployment和Service来管理不同服务的部署和负载均衡。
    * CI/CD：
        * 配置GitHub Actions或GitLab CI来实现自动化部署。
        * 在每次代码提交时自动执行测试、构建镜像并推送到Docker Registry。
* 消息队列：RabbitMQ/Kafka（用于服务之间的异步通信）

## 服务器功能
* 用户管理模块：
    * 注册与登录：用户注册、登录功能，支持玩家的身份认证，可以使用JWT进行令牌验证。
    * 玩家状态管理：管理玩家的月光值、卡牌状态、地图进度等。
* 游戏引擎模块：
    * 卡牌机制引擎：根据游戏灵感中的卡牌机制（如“同相”、“反相”、“月相周期”）计算并更新玩家的状态。
    * 地图与格子管理：管理玩家的竞速地图，计算玩家的进度、归属权、月光消耗等。
    * 事件机制：实现全局事件，如“月光风暴”、“干扰区”等，根据游戏进度动态触发，并通知前端。
* PVP与PVE机制：
    * PVP机制：管理玩家之间的对抗与月光消耗，判断玩家是否有资格前进。
    * PVE机制：根据章节的主题与BOSS设计，控制剧情的推进，利用月相牌解锁剧情。
* 游戏存档与重启：
    * 保存游戏的进度和玩家状态，支持断线重连和游戏重启。
    * 存储玩家的卡牌、月光进度、地图状态等数据。
* 推送与通知：
    * 后端通过WebSocket推送实时游戏状态更新给前端。